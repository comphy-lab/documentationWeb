<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<a id="" href="#"></a>
    <!-- Basic SEO Meta Tags -->
    <meta name="description" content="Computational fluid dynamics simulations using Basilisk C framework.">
    <meta name="author" content="Computational Multiphase Physics Laboratory">
    <meta name="keywords" content="fluid dynamics, CFD, Basilisk, multiphase flow, computational physics">
<a id="" href="#"></a>
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="Test documentation: Lid driven cavity using dye injection - testCases/LidDrivenCavity-Newtonian-dyeInjection.c">
    <meta property="og:description" content="Computational fluid dynamics simulations using Basilisk C framework.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://test.comphy-lab.org/testCases/LidDrivenCavity-Newtonian-dyeInjection.c.html">
    <meta property="og:image" content="https://test.comphy-lab.org/assets/logos/CoMPhy-Lab.svg">
<a id="" href="#"></a>
    <!-- Canonical URL -->
    <link rel="canonical" href="https://test.comphy-lab.org/testCases/LidDrivenCavity-Newtonian-dyeInjection.c.html">
<a id="" href="#"></a>
    <title>Test documentation: Lid driven cavity using dye injection - testCases/LidDrivenCavity-Newtonian-dyeInjection.c</title>
<a id="" href="#"></a>
    <!-- Critical CSS -->
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --text-color: #333;
            --background-color: #fff;
            --code-background: #f5f5f5;
        }
<a id="" href="#"></a>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }
<a id="" href="#"></a>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
<a id="" href="#"></a>
        pre, code {
            background: var(--code-background);
            border-radius: 4px;
            padding: 0.2em 0.4em;
        }
<a id="" href="#"></a>
        pre {
            padding: 1em;
            overflow-x: auto;
        }
    </style>
<a id="" href="#"></a>
    <!-- Preload Critical Resources -->
    <link rel="preload" href="//assets/css/styles.css" as="style">
    <link rel="preload" href="//assets/css/custom_styles.css" as="style">
    <link rel="preload" href="//assets/js/main.js" as="script">
<a id="" href="#"></a>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="//assets/logos/CoMPhy-Lab.svg">
    <link rel="apple-touch-icon" href="//assets/logos/CoMPhy-Lab.svg">
<a id="" href="#"></a>
    <!-- Stylesheets -->
    <link rel="stylesheet" href="//assets/css/styles.css">
    <link rel="stylesheet" href="//assets/css/custom_styles.css">
    <link rel="stylesheet" href="//assets/css/command-palette.css">
    <link rel="stylesheet" href="//assets/css/vendor.css">
<a id="" href="#"></a>
    <!-- KaTeX for Math -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css">
<a id="" href="#"></a>
    <!-- jQuery and UI -->
    <script src="//js/jquery.min.js"></script>
    <script src="//js/jquery-ui.packed.js"></script>
    <script src="//js/plots.js"></script>
<a id="" href="#"></a>
    <!-- KaTeX -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js"></script>
<a id="" href="#"></a>
    <!-- Command Palette -->
    <script src="//assets/js/command-palette.js"></script>
    <script src="//assets/js/command-data.js"></script>
    <script src="//assets/js/shortcut-key.js"></script>
    <link href="../custom_styles.css" rel="stylesheet" type="text/css" />
    </head>
<body>
    <div class="container">
        <header class="site-header">
            <nav class="main-nav">
                <a href="//" class="logo">
                    <img src="//assets/logos/CoMPhy-Lab.svg" alt="CoMPhy-Lab Logo" height="40">
                </a>
                <div class="nav-links">
                    <a href="//Tutorial">Tutorial</a>
                    <a href="//src/INSTALL">Installation</a>
                    <a href="//Basilisk C">Basilisk C</a>
                    <a href="//src/README">Solvers</a>
                    <a href="//src/examples/README">Examples</a>
                </div>
            </nav>
        </header>
<a id="" href="#"></a>
        <main class="content">
<a id="" href="#"></a>
            <div class="page-content">
<a id="" href="#"></a>
                                <h1 class="page-title">testCases/LidDrivenCavity-Newtonian-dyeInjection.c</h1>
<a id="" href="#"></a>
<a id="" href="#"></a>
                <h1
                id="lid-driven-cavity-flow-of-a-newtonian-fluid-with-dye-injection">Lid-Driven
                Cavity Flow of a Newtonian Fluid with dye Injection</h1>
                <p>This simulation models a lid-driven cavity flow for a
                Newtonian fluid with constant viscosity and includes dye
                injection for flow visualization. This extends the
                classic benchmark case with a passive tracer to
                visualize flow patterns.</p>
                <h2 id="parameters">Parameters</h2>
                <ul>
                <li>Reynolds number: Re = ρUL/μ = 1/μ (with ρ=1, U=1,
                L=1)</li>
                <li>We use μ = 1.0 by default (Re = 1)</li>
                <li>dye injection at t=0.05 in the upper center of the
                cavity</li>
                </ul>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><span class="pp">#include </span><a href="http://basilisk.fr/src/navier-stokes/centered.h" title="Link to Basilisk source for navier-stokes/centered.h"><span class="im">"navier-stokes/centered.h"</span></a></span>
<span id="cb1-2"><span class="pp">#include </span><a href="../src-local/dye-injection.h.html" title="Link to local documentation for dye-injection.h"><span class="im">"dye-injection.h"</span></a></span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co">// Constants</span></span>
<span id="cb1-5"><span class="pp">#define LEVEL   </span><span class="dv">8</span><span class="pp">       </span><span class="co">// Grid refinement level</span></span>
<span id="cb1-6"><span class="pp">#define MAXDT   </span><span class="op">(</span><span class="fl">1e-4</span><span class="op">)</span><span class="pp">  </span><span class="co">// Maximum timestep</span></span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="co">// Global variables</span></span>
<span id="cb1-9"><span class="dt">int</span> imax <span class="op">=</span> <span class="fl">1e5</span><span class="op">;</span>                   <span class="co">// Maximum iterations</span></span>
<span id="cb1-10"><span class="dt">double</span> tmax <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span>                <span class="co">// Maximum simulation time</span></span>
<span id="cb1-11"><span class="dt">double</span> tsnap <span class="op">=</span> <span class="fl">0.01</span><span class="op">;</span>              <span class="co">// Time interval between snapshots</span></span>
<span id="cb1-12"><span class="dt">double</span> end <span class="op">=</span> <span class="fl">2.0</span><span class="op">;</span>                 <span class="co">// End time for simulation</span></span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="co">// Scalar field for convergence check</span></span>
<span id="cb1-15">scalar un<span class="op">[];</span>  <span class="co">// Previous x-velocity</span></span>
<span id="cb1-16"><span class="dt">const</span> face vector muv<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">};</span>      <span class="co">// Face-centered viscosity field</span></span></code></pre></div></div>
                <h2 id="boundary-conditions">Boundary Conditions</h2>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><span class="co">// Top moving wall (lid)</span></span>
<span id="cb2-2">u<span class="op">.</span>t<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> dirichlet<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb2-3"><span class="co">// Other no-slip boundaries</span></span>
<span id="cb2-4">u<span class="op">.</span>t<span class="op">[</span>bottom<span class="op">]</span> <span class="op">=</span> dirichlet<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb2-5">u<span class="op">.</span>t<span class="op">[</span>left<span class="op">]</span>   <span class="op">=</span> dirichlet<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb2-6">u<span class="op">.</span>t<span class="op">[</span>right<span class="op">]</span>  <span class="op">=</span> dirichlet<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb2-7"><span class="co">// uf.n[left]   = 0;</span></span>
<span id="cb2-8"><span class="co">// uf.n[right]  = 0;</span></span>
<span id="cb2-9"><span class="co">// uf.n[top]    = 0;</span></span>
<span id="cb2-10"><span class="co">// uf.n[bottom] = 0;</span></span></code></pre></div></div>
                <h2 id="initialization">Initialization</h2>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb3-1">event init <span class="op">(</span>t <span class="op">=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-2">  <span class="co">// Set constant viscosity for Newtonian fluid</span></span>
<span id="cb3-3">  mu <span class="op">=</span> muv<span class="op">;</span></span>
<span id="cb3-4"></span>
<span id="cb3-5">  <span class="co">// Initialize velocity field</span></span>
<span id="cb3-6">  foreach<span class="op">()</span> <span class="op">{</span></span>
<span id="cb3-7">    u<span class="op">.</span>x<span class="op">[]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-8">    u<span class="op">.</span>y<span class="op">[]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-9">    un<span class="op">[]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-10">  <span class="op">}</span></span>
<span id="cb3-11"></span>
<span id="cb3-12">  dump <span class="op">(</span>file <span class="op">=</span> <span class="st">&quot;start&quot;</span><span class="op">);</span></span>
<span id="cb3-13"><span class="op">}</span></span></code></pre></div></div>
                <h2 id="snapshot-generation">Snapshot Generation</h2>
                <p>Save snapshots at regular intervals for flow
                visualization</p>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb4-1">event writingFiles <span class="op">(</span>t<span class="op">=</span><span class="fl">0.</span><span class="op">;</span> t <span class="op">+=</span> tsnap<span class="op">;</span> t <span class="op">&lt;</span> tmax<span class="op">+</span>tsnap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-2">  <span class="dt">char</span> filename<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span>
<span id="cb4-3">  sprintf<span class="op">(</span>filename<span class="op">,</span> <span class="st">&quot;intermediate/snapshot-</span><span class="sc">%5.4f</span><span class="st">&quot;</span><span class="op">,</span> t<span class="op">);</span></span>
<span id="cb4-4">  dump<span class="op">(</span>file<span class="op">=</span>filename<span class="op">);</span></span>
<span id="cb4-5"><span class="op">}</span></span></code></pre></div></div>
                <h3
                id="logs-simulation-progress-and-convergence-details.">Logs
                simulation progress and convergence details.</h3>
                <p>On each iteration, this event updates the stored
                x-velocity field for convergence checking and logs the
                current iteration number, timestep (dt), simulation time
                (t), and the convergence error (difference between the
                current and previous x-velocity fields) to the log
                file.</p>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb5-1">event logfile <span class="op">(</span>i<span class="op">++;</span> i <span class="op">&lt;=</span> imax<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-2">  foreach<span class="op">()</span> <span class="op">{</span></span>
<span id="cb5-3">    un<span class="op">[]</span> <span class="op">=</span> u<span class="op">.</span>x<span class="op">[];</span></span>
<span id="cb5-4">  <span class="op">}</span></span>
<span id="cb5-5">  fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;i = </span><span class="sc">%d</span><span class="st">: dt = </span><span class="sc">%g</span><span class="st">, t = </span><span class="sc">%g</span><span class="st">, err = </span><span class="sc">%g\n</span><span class="st">&quot;</span><span class="op">,</span> i<span class="op">,</span> dt<span class="op">,</span> t<span class="op">,</span> change<span class="op">(</span>u<span class="op">.</span>x<span class="op">,</span> un<span class="op">));</span></span>
<span id="cb5-6"><span class="op">}</span></span></code></pre></div></div>
                <h3
                id="outputs-final-simulation-results-for-visualization.">Outputs
                final simulation results for visualization.</h3>
                <p>When the simulation reaches the end time, this event
                outputs the final state of simulation fields to a file
                named “results” for post-processing and
                visualization.</p>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb6-1">event end <span class="op">(</span>t <span class="op">=</span> end<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-2">  <span class="co">// Output fields in a format suitable for visualization</span></span>
<span id="cb6-3">  dump<span class="op">(</span>file<span class="op">=</span><span class="st">&quot;results&quot;</span><span class="op">);</span></span>
<span id="cb6-4"><span class="op">}</span></span></code></pre></div></div>
                <h3
                id="entry-point-for-the-lid-driven-cavity-flow-simulation-with-dye-injection.">Entry
                point for the lid-driven cavity flow simulation with dye
                injection.</h3>
                <p>Initializes the computational grid and simulation
                parameters (domain size, timestep, tolerance, and CFL
                condition), and stores the initial velocity field for
                convergence monitoring. Configures dye injection
                settings by defining the injection time and location,
                creates a directory for saving intermediate simulation
                snapshots, and triggers the simulation run.</p>
                <p><span class="citation"
                data-cites="return">@return</span> int Exit status code
                (typically 0 upon successful completion).</p>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb7-2">  <span class="co">// Initialize grid and parameters</span></span>
<span id="cb7-3">  init_grid<span class="op">(</span><span class="dv">1</span><span class="op">&lt;&lt;</span>LEVEL<span class="op">);</span></span>
<span id="cb7-4">  L0 <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb7-5">  origin<span class="op">(-</span><span class="fl">0.5</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb7-6">  DT <span class="op">=</span> MAXDT<span class="op">;</span></span>
<span id="cb7-7">  TOLERANCE <span class="op">=</span> <span class="fl">1e-5</span><span class="op">;</span></span>
<span id="cb7-8">  CFL <span class="op">=</span> <span class="fl">0.25</span><span class="op">;</span></span>
<span id="cb7-9"></span>
<span id="cb7-10">  <span class="co">// Store current velocity for convergence check</span></span>
<span id="cb7-11">  foreach<span class="op">()</span> <span class="op">{</span></span>
<span id="cb7-12">    un<span class="op">[]</span> <span class="op">=</span> u<span class="op">.</span>x<span class="op">[];</span></span>
<span id="cb7-13">  <span class="op">}</span></span>
<span id="cb7-14"></span>
<span id="cb7-15">  <span class="co">// dye injection parameters</span></span>
<span id="cb7-16">  tInjection <span class="op">=</span> <span class="fl">0.05</span><span class="op">;</span>        <span class="co">// Inject the dye after flow is established</span></span>
<span id="cb7-17">  xInjection <span class="op">=</span> <span class="fl">0.00</span><span class="op">;</span>        <span class="co">// X position (center of cavity)</span></span>
<span id="cb7-18">  yInjection <span class="op">=</span> <span class="fl">0.40</span><span class="op">;</span>        <span class="co">// Y position (center of cavity)</span></span>
<span id="cb7-19"></span>
<span id="cb7-20">  <span class="co">// Create a folder named intermediate where all the simulation snapshots are stored.</span></span>
<span id="cb7-21">  <span class="dt">char</span> comm<span class="op">[</span><span class="dv">80</span><span class="op">];</span></span>
<span id="cb7-22">  sprintf <span class="op">(</span>comm<span class="op">,</span> <span class="st">&quot;mkdir -p intermediate&quot;</span><span class="op">);</span></span>
<span id="cb7-23">  system<span class="op">(</span>comm<span class="op">);</span></span>
<span id="cb7-24"></span>
<span id="cb7-25">  <span class="co">// Run simulation</span></span>
<span id="cb7-26">  run<span class="op">();</span></span>
<span id="cb7-27"></span>
<span id="cb7-28"><span class="op">}</span></span></code></pre></div></div>
            </div>
        </main>
<a id="" href="#"></a>
        <footer class="site-footer">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="//assets/logos/CoMPhy-Lab.svg" alt="CoMPhy-Lab Logo" height="30">
                </div>
                <div class="footer-links">
                    <a href="//Help">Help</a>
                    <a href="http://groups.google.com/d/forum/basilisk-fr">Forum</a>
                    <a href="//src/Contributing">Contribute</a>
                </div>
            </div>
        </footer>
    </div>
<a id="" href="#"></a>
    <!-- Command Palette Modal -->
    <div id="command-palette" class="command-palette">
        <div class="command-palette-content">
            <input type="text" id="command-input" placeholder="Type a command or search...">
            <div id="command-results"></div>
        </div>
    </div>
<a id="" href="#"></a>
    <!-- Main JavaScript -->
    <script src="//assets/js/main.js"></script>

    <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        // Add copy button to each code block container
        const codeBlocks = document.querySelectorAll('.code-block-container pre');
        codeBlocks.forEach(function(codeBlock, index) {
            // Create button element
            const button = document.createElement('button');
            button.className = 'copy-button';
            button.textContent = 'Copy';
            button.setAttribute('aria-label', 'Copy code to clipboard');
            button.setAttribute('data-copy-state', 'copy');
            
            // Get the code block container (parent of the pre)
            const container = codeBlock.parentNode;
            
            // Add the button to the container
            container.appendChild(button);
            
            // Set up click event
            button.addEventListener('click', function() {
                // Create a textarea element to copy from
                const textarea = document.createElement('textarea');
                // Get the text content from the pre element (the actual code)
                textarea.value = codeBlock.textContent;
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    // Execute copy command
                    document.execCommand('copy');
                    // Update button state
                    button.textContent = 'Copied!';
                    button.classList.add('copied');
                    
                    // Reset button state after 2 seconds
                    setTimeout(function() {
                        button.textContent = 'Copy';
                        button.classList.remove('copied');
                    }, 2000);
                } catch (err) {
                    console.error('Copy failed:', err);
                    button.textContent = 'Error!';
                }
                
                // Clean up
                document.body.removeChild(textarea);
            });
        });
    });
    </script>
        </body>
</html>
